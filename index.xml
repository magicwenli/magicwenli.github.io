<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Great Expectations</title><link>/</link><description>Recent content on Great Expectations</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 26 Nov 2021 02:37:41 +0800</lastBuildDate><atom:link href="/index.xml" rel="self" type="application/rss+xml"/><item><title>Android 抓包之歪路</title><link>/posts/android-emulator-packet-capture-and-everything/</link><pubDate>Fri, 26 Nov 2021 02:37:41 +0800</pubDate><guid>/posts/android-emulator-packet-capture-and-everything/</guid><description>最佳实践 Android 5.1 安装夜神模拟器，打开夜神多开器，添加Android版本为5.1的模拟器。下载完成后启动。 下载Fiddler Everywhere。</description><content>&lt;h2 id="最佳实践">最佳实践&lt;/h2>
&lt;h3 id="android-51">Android 5.1&lt;/h3>
&lt;ol>
&lt;li>安装&lt;code>夜神&lt;/code>模拟器，打开夜神多开器，添加Android版本为5.1的模拟器。下载完成后启动。&lt;/li>
&lt;li>下载&lt;code>Fiddler Everywhere&lt;/code>。Setting—Https—Advanced Setting—Export root certificate.&lt;/li>
&lt;li>将桌面的&lt;code>FiddlerRootCertificate.crt&lt;/code>复制到&lt;code>C:\Users\&amp;lt;UserName&amp;gt;\Nox_share\Download&lt;/code>，此处为共享路径。&lt;/li>
&lt;li>在模拟器中手动安装证书。设置—安全—从SD卡安装。&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="../../static/img/Snipaste_2021-11-26_01-12-38.png" alt="Snipaste_2021-11-26_01-12-38">&lt;/p>
&lt;ol start="5">
&lt;li>设置WiFi代理。&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="../../static/img/Snipaste_2021-11-26_01-17-55.png" alt="Snipaste_2021-11-26_01-17-55">&lt;/p>
&lt;ol start="6">
&lt;li>OK&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="../../static/img/Snipaste_2021-11-26_01-27-55.png" alt="Snipaste_2021-11-26_01-27-55">&lt;/p>
&lt;h3 id="android-70">Android 7.0&lt;/h3>
&lt;p>安装Android版本为7.0的模拟器，在添加完毕证书后，进行一个额外的步骤。&lt;/p>
&lt;p>通过adb工具将用户证书添加到&lt;strong>系统证书&lt;/strong>中，先确保adb已连接，见&lt;a href="#ADB">ADB&lt;/a>。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#75715e"># WSL ubuntu 18.04&lt;/span>
HASH_FILE_NAME&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#66d9ef">$(&lt;/span>adb shell ls /data/misc/user/0/cacerts-added&lt;span style="color:#66d9ef">)&lt;/span>
echo &lt;span style="color:#e6db74">&amp;#34;HASH_FILE_NAME: &lt;/span>$HASH_FILE_NAME&lt;span style="color:#e6db74">&amp;#34;&lt;/span>
adb pull /data/misc/user/0/cacerts-added/$HASH_FILE_NAME
adb push $HASH_FILE_NAME /system/etc/security/cacerts/
adb shell ls -lt /system/etc/security/cacerts/ | head -5
echo &lt;span style="color:#e6db74">&amp;#34;Add system certs successful&amp;#34;&lt;/span>
rm $HASH_FILE_NAME
&lt;/code>&lt;/pre>&lt;/div>&lt;p>设置代理，或者通过&lt;code>Proxifier&lt;/code>添加一个端口为8866的http代理服务器，与一条&lt;code>nox*.exe&lt;/code> proxy的代理规则。&lt;/p>
&lt;h2 id="防止失忆做的补充">防止失忆做的补充&lt;/h2>
&lt;h3 id="抓包工具">抓包工具&lt;/h3>
&lt;h4 id="fiddler">Fiddler&lt;/h4>
&lt;p>Fiddler现在分了&lt;code>classic&lt;/code>和&lt;code>everywhere&lt;/code>两个版本，这两版基本功能都一样，各有特点。&lt;/p>
&lt;p>后者在UI上做了升级，显示内容比较直观，更加Accessible。新UI给人一股Postman味，这是一句夸奖的话。必须&lt;strong>登录账户&lt;/strong>才能使使用，提供了云服务，同时以订阅制收费。&lt;/p>
&lt;p>老版本也能照常使用，有很多强大的开源插件，比如&lt;a href="https://github.com/lulianqi/FreeHttp">FreeHttp&lt;/a>。在网页中访问&lt;code>http://localhost:&amp;lt;proxy-port&amp;gt;&lt;/code>，里面就有证书的下载链接。&lt;/p>
&lt;p>它们的使用过程都是打开代理—允许远程访问—生成证书。不过我在用&lt;code>classic&lt;/code>版时，远程应用无论如何都连接不到代理上，用新版没有问题。&lt;/p>
&lt;h4 id="postman">Postman&lt;/h4>
&lt;p>感觉这个公司的工具非常有极客精神，他们的产品既好用，又&lt;code>Free of use&lt;/code>。通过代理抓包只是它的一个小功能，设置好端口，按照&lt;a href="https://learning.postman.com/docs/sending-requests/capturing-request-data/capturing-http-requests/#capture-https-traffic-with-postmans-built-in-proxy">官方文档&lt;/a>里说的做就好。记得下载安装 &lt;a href="https://slproweb.com/products/Win32OpenSSL.html">OpenSSL v1.1.1L&lt;/a>的时候不要选带Light的版本，安装完毕后重启Postman，随后就能在&lt;code>%APPDATA%\Postman\proxy&lt;/code>找到证书&lt;code>postman-proxy-ca.crt&lt;/code>。&lt;/p>
&lt;p>&lt;img src="../../static/img/Snipaste_2021-11-26_01-57-36.png" alt="Snipaste_2021-11-26_01-57-36">&lt;/p>
&lt;h4 id="proxifier">Proxifier&lt;/h4>
&lt;p>这个工具是专门给程序设置代理的。有时有为每个程序分别设置代理的需求，程序本身提供代理设置的还好说（但手工管理它们也不轻松），没有这个选项的那就只能使用&lt;code>Proxifier&lt;/code>这类工具了。&lt;/p>
&lt;p>手工设置Android代理，就是填写WiFi设置中的高级选项。&lt;/p>
&lt;h3 id="证书">证书&lt;/h3>
&lt;p>用自己的手机是可行的，不过用虚拟机是更稳妥的选择。抓包的时候会安装证书，手机自带的证书是&lt;strong>系统证书&lt;/strong>，而我们之后安装的证书是&lt;strong>用户证书&lt;/strong>，两者的级别和权限是不一样的。&lt;/p>
&lt;p>7.0之后的Android就不再&lt;strong>信任用户证书&lt;/strong>了。所以在进行抓包时，数据并不走&lt;strong>用户证书&lt;/strong>，App也会发出一个不再信任证书的警告，也就抓不到包。而5.1版本，系统信任&lt;strong>用户证书&lt;/strong>。&lt;/p>
&lt;p>&lt;img src="../../static/img/Snipaste_2021-11-26_01-18-05.png" alt="Snipaste_2021-11-26_01-18-05">&lt;/p>
&lt;p>这里我走了一些弯路，不过总结一下可以找到3种使得证书信任的方法：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>直接安装5.1系统，随后安装证书（设置-安全-从SDCard安装证书）。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安装7.0或以上的系统，想办法将我们的证书添加到&lt;strong>系统证书&lt;/strong>[4]。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安装7.0或以上的系统，安装&lt;code>xposed&lt;/code>，hook certificate pinning，使得app跳过证书校验[7]。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="android虚拟机">Android虚拟机&lt;/h3>
&lt;p>这方面尝试的不多，自己仅用过&lt;code>蓝叠(Bluestacks)&lt;/code>，&lt;code>夜神(Nox)&lt;/code>和&lt;code>Genymotion&lt;/code>。听说网易&lt;code>MoMo&lt;/code>也不错，最后用的是夜神。&lt;/p>
&lt;p>刚好三种都分别安装、卸载了一遍。&lt;/p>
&lt;p>&lt;code>Genymotion&lt;/code>安装好了直接无法启动虚拟机，G了。&lt;/p>
&lt;p>&lt;code>蓝叠&lt;/code>的Rom定制化程度很高，换句话说就是与原生系统差别比较大。系统设置里许多地方缺失了，好像没找到添加证书的入口。它除广告外还自带了Chrome和另一些常用工具，甚好。&lt;/p>
&lt;p>&lt;code>夜神&lt;/code>这款基本上满足了抓包的需要。自带Root权限，这样就可以装&lt;code>Xposed&lt;/code>，还可以装&lt;code>Termux&lt;/code>玩玩。有个官方论坛有许多交流帖子，国外也有很多人用。遇到问题比较容易解决。&lt;/p>
&lt;h3 id="adb">ADB&lt;/h3>
&lt;p>打开USB调试。&lt;code>夜神&lt;/code>的USB调试并不通过默认的5037 端口与adb客户端通信，可能是考虑多开也许超过16个客户端的官方限制。&lt;/p>
&lt;p>一般情况下，只需以下步骤就能连接adb&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-shell" data-lang="shell">&lt;span style="color:#75715e"># WSL ubuntu 18.04&lt;/span>
wesley@WIN10:/mnt/c/Users/Vita/Desktop$ adb devices
List of devices attached
wesley@WIN10:/mnt/c/Users/Vita/Desktop$ adb connect 127.0.0.1:62001
connected to 127.0.0.1:62001
wesley@WIN10:/mnt/c/Users/Vita/Desktop$ adb devices
List of devices attached
127.0.0.1:62001 device
&lt;/code>&lt;/pre>&lt;/div>&lt;p>虚拟机比较多时就无效了，需要手动找到端口[3]。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-powershell" data-lang="powershell">&lt;span style="color:#75715e"># Powershell&lt;/span>
PS C:\Users\Vita&amp;gt; Get-Process | where name &lt;span style="color:#f92672">-like&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Nox*&amp;#34;&lt;/span>
Handles NPM(K) PM(K) WS(K) CPU(s) Id SI ProcessName
------- ------ ----- ----- ------ -- -- -----------
1037 184 177620 49000 161.20 28604 1 Nox
2006 173 1046392 46020 251.53 4716 1 NoxVMHandle
3058 16 6268 19040 0.67 27528 1 NoxVMSVC
PS C:\Users\Vita&amp;gt; Get-NetTcpConnection -OwningProcess 4716 -State Listen
LocalAddress LocalPort RemoteAddress RemotePort State AppliedSetting
------------ --------- ------------- ---------- ----- --------------
127.0.0.1 64001 0.0.0.0 0 Listen
127.0.0.1 63001 0.0.0.0 0 Listen
127.0.0.1 62001 0.0.0.0 0 Listen
127.0.0.1 61001 0.0.0.0 0 Listen
&lt;/code>&lt;/pre>&lt;/div>&lt;p>依次尝试连接这些&lt;code>LocalPort&lt;/code>，验证&lt;code>adb devices&lt;/code>是否正常。&lt;/p>
&lt;h2 id="参考文档">参考文档&lt;/h2>
&lt;p>[1]loco, “当你写爬虫抓不到APP请求包的时候该怎么办？【中级篇】,” &lt;em>知乎专栏&lt;/em>, 2019. &lt;a href="https://zhuanlan.zhihu.com/p/56397466">https://zhuanlan.zhihu.com/p/56397466&lt;/a> (accessed Nov. 25, 2021).&lt;/p>
&lt;p>[2]空夜无殇, “手机抓不到包的原因与解决方法（非xposed框架）,” &lt;em>知乎专栏&lt;/em>, 2021. &lt;a href="https://zhuanlan.zhihu.com/p/349267640">https://zhuanlan.zhihu.com/p/349267640&lt;/a> (accessed Nov. 25, 2021).&lt;/p>
&lt;p>[3]Mateusz, “ADB can’t connect to Nox,” &lt;em>Stack Overflow&lt;/em>, Jul. 06, 2018. &lt;a href="https://stackoverflow.com/questions/51214825/adb-cant-connect-to-nox">https://stackoverflow.com/questions/51214825/adb-cant-connect-to-nox&lt;/a> (accessed Nov. 25, 2021).&lt;/p>
&lt;p>[4]pwlin, “Android : add cert to system store,” &lt;em>Gist&lt;/em>, Mar. 07, 2016. &lt;a href="https://gist.github.com/pwlin/8a0d01e6428b7a96e2eb">https://gist.github.com/pwlin/8a0d01e6428b7a96e2eb&lt;/a> (accessed Nov. 25, 2021).&lt;/p>
&lt;p>[5]“Capturing HTTP requests,” &lt;em>Postman Learning Center&lt;/em>, 2021. &lt;a href="https://learning.postman.com/docs/sending-requests/capturing-request-data/capturing-http-requests/#capture-https-traffic-with-postmans-built-in-proxy">https://learning.postman.com/docs/sending-requests/capturing-request-data/capturing-http-requests/#capture-https-traffic-with-postmans-built-in-proxy&lt;/a> (accessed Nov. 25, 2021).&lt;/p>
&lt;p>[6]用户1470878743, “7.x系统的夜神安装Xposed - 辅助工具 夜神游戏论坛,” &lt;em>Yeshen.com&lt;/em>, 2021. &lt;a href="https://bbs.yeshen.com/forum.php?mod=viewthread&amp;amp;tid=33446">https://bbs.yeshen.com/forum.php?mod=viewthread&amp;amp;tid=33446&lt;/a> (accessed Nov. 25, 2021).&lt;/p>
&lt;p>[7]ac-pm, “SSLUnpinning_Xposed: Android Xposed Module to bypass SSL certificate validation (Certificate Pinning).,” &lt;em>GitHub&lt;/em>, 2021. &lt;a href="https://github.com/ac-pm/SSLUnpinning_Xposed">https://github.com/ac-pm/SSLUnpinning_Xposed&lt;/a> (accessed Nov. 25, 2021).&lt;/p></content></item><item><title>R语言列表操作和连接MongoDB经验之谈</title><link>/posts/r-lang-useful-tricks/</link><pubDate>Wed, 10 Nov 2021 17:28:19 +0800</pubDate><guid>/posts/r-lang-useful-tricks/</guid><description>RStudio R语言的好处 在做Teamfight Tactics分析时，我先通过Riot&amp;rsquo;s API收集到了许多场次的对局数据。如何将这些复杂的</description><content>
&lt;figure class="center" >
&lt;img src="/img/RStudio.png" alt="RStudio" style="border-radius: 8px;" />
&lt;figcaption class="left" style="color: black; " >RStudio&lt;/figcaption>
&lt;/figure>
&lt;h2 id="r语言的好处">R语言的好处&lt;/h2>
&lt;p>在做Teamfight Tactics分析时，我先通过Riot&amp;rsquo;s API收集到了许多场次的对局数据。如何将这些复杂的数据转换成可以直接使用的数据，方便进行分析呢？&lt;/p>
&lt;p>之前一直用的是Python，思路是通过pymongo包连接MongoDB提取数据，再通过python内建函数进行转换和分析。这样需要不停使用&lt;code>Table[&amp;quot;sub&amp;quot;]['subsub']&lt;/code>这样的格式取得内部结构。这部分内容没有代码提示，需要程序员自行记忆每个&lt;code>Key&lt;/code>对应的结构，不仅麻烦，而且容易出错。可以预计分析数据的时候会用到大量循环，而python的效率让人缺乏信心。再加上后续还有画图步骤，而&lt;code>matplotlib&lt;/code>是一个非常麻烦的东西，我有点害怕。&lt;/p>
&lt;p>也考虑过使用&lt;code>Matlab&lt;/code>，它的好处是不少循环可以转为向量化运算，速度会快不少，而且画图容易。&lt;code>Matlab&lt;/code>的附加功能里有一个&lt;code>Database Toolbox Interface for MongoDB&lt;/code>。我甚至已经使用它进行了一段时间分析了，但后面发现默认生成的&lt;code>.mat&lt;/code>格式转换为其他格式比较困难。而且运行速度也不是很理想，消耗资源很大，400MB的数据量在运算时常常卡死我的电脑。也可能是因为我不常使用它，所有代码本身编写的也不够好。&lt;/p>
&lt;p>最后终于接触到了R语言，这真是个好工具。配合RStudio，顺手又高效。它解决了上面的所有问题，而且内建和社区的函数和包为分析过程提供了很大帮助，为我节省了很多时间。它的一些用法和其他语言显得有些奇怪，理解和熟悉需要一些时间，但R语言的学习绝对物超所值。&lt;/p>
&lt;p>李东风老师的开源R语言教程很好，推荐一下：&lt;a href="https://www.math.pku.edu.cn/teachers/lidf/docs/Rbook/html/_Rbook/index.html">https://www.math.pku.edu.cn/teachers/lidf/docs/Rbook/html/_Rbook/index.html&lt;/a>&lt;/p>
&lt;h2 id="r语言的数据类型">R语言的数据类型&lt;/h2>
&lt;h3 id="向量">向量&lt;/h3>
&lt;p>向量是将若干个基础类型&lt;strong>相同&lt;/strong>的值存储在一起，各个元素可以按序号访问。需要注意的是，R语言各种类型的数据结构的下标都是从1开始的。例如&lt;/p>
&lt;div class="collapsable-code">
&lt;input id="1" type="checkbox" />
&lt;label for="1">
&lt;span class="collapsable-code__language">R&lt;/span>
&lt;span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide">&lt;/span>
&lt;/label>
&lt;pre class="language-R" >&lt;code>
# 数值型
marks &amp;lt;- c(10, 6, 4, 7, 8)
x &amp;lt;- c(1:3, 10:13)
# 逻辑型
c(1, 3, 5) &amp;gt; 2 # [1] FALSE TRUE TRUE
# 字符型
s1 &amp;lt;- c(&amp;#39;abc&amp;#39;, &amp;#39;&amp;#39;, &amp;#39;a cat&amp;#39;, NA, &amp;#39;李明&amp;#39;)
&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>内建的大多数函数以向量为参数时，会对向量内的元素逐个运算，然后返回一个和原来一样长的向量。&lt;/p>
&lt;div class="collapsable-code">
&lt;input id="2" type="checkbox" />
&lt;label for="2">
&lt;span class="collapsable-code__language">R&lt;/span>
&lt;span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide">&lt;/span>
&lt;/label>
&lt;pre class="language-R" >&lt;code>
sqrt(c(1, 4, 6.25)) # [1] 1.0 2.0 2.5
x &amp;lt;- c(33, 55, 11)
order(x) # [1] 3 1 2
x[order(x)] # [1] 11 33 55
&lt;/code>&lt;/pre>
&lt;/div>
&lt;h3 id="列表">列表&lt;/h3>
&lt;p>R中列表(&lt;code>list&lt;/code>)类型来保存&lt;strong>不同&lt;/strong>类型的数据。一个主要目的是提供R分析结果输出包装：输出一个变量，这个变量包括回归系数、预测值、残差、检验结果等等一系列不能放到规则形状数据结构中的内容。实际上，数据框也是列表的一种，但是数据框要求各列等长，而列表不要求。&lt;/p>
&lt;p>列表可以命名，命名后类似字典，可以通过名字访问。&lt;/p>
&lt;div class="collapsable-code">
&lt;input id="3" type="checkbox" />
&lt;label for="3">
&lt;span class="collapsable-code__language">R&lt;/span>
&lt;span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide">&lt;/span>
&lt;/label>
&lt;pre class="language-R" >&lt;code>
rec &amp;lt;- list(name=&amp;#34;李明&amp;#34;, age=30,
scores=c(85, 76, 90))
rec
## $name
## [1] &amp;#34;李明&amp;#34;
##
## $age
## [1] 30
##
## $scores
## [1] 85 76 90
rec$age # 或 rec[[&amp;#34;age&amp;#34;]]
&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>也可以通过下标访问，但需要两重中括号。如果使用单重方括号对列表取子集，结果还是列表而不是列表元素。&lt;/p>
&lt;div class="collapsable-code">
&lt;input id="4" type="checkbox" />
&lt;label for="4">
&lt;span class="collapsable-code__language">R&lt;/span>
&lt;span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide">&lt;/span>
&lt;/label>
&lt;pre class="language-R" >&lt;code>
rec[[3]]
## [1] 85 76 90
rec[[3]][2]
## [1] 76
rec[3]
## $scores
## [1] 85 76 90
&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>要删除某个元素，直接将该元素赋值为&lt;code>NULL&lt;/code>；添加元素则是直接为该元素赋值。&lt;/p>
&lt;div class="collapsable-code">
&lt;input id="5" type="checkbox" />
&lt;label for="5">
&lt;span class="collapsable-code__language">R&lt;/span>
&lt;span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide">&lt;/span>
&lt;/label>
&lt;pre class="language-R" >&lt;code>
rec[[&amp;#34;age&amp;#34;]] &amp;lt;- NULL
rec[[&amp;#34;身高&amp;#34;]] &amp;lt;- 178
## $name
## [1] &amp;#34;李明&amp;#34;
##
## $三科分数
## [1] 85 0 90
##
## $身高
## [1] 178
&lt;/code>&lt;/pre>
&lt;/div>
&lt;h3 id="数据框">数据框&lt;/h3>
&lt;p>数据框类似于数据库表或Excel数据表的形式。这样形式的数据在R中叫做数据框(&lt;code>data.frame&lt;/code>)。数据框类似于一个矩阵，有$n$个横行、$p$个纵列，但各列允许有不同类型：数值型向量、因子、字符型向量、日期时间向量。同一列的数据类型相同。数据框是一个特殊的列表，其每个列表元素都是一个长度相同的向量。&lt;/p>
&lt;p>数据框可以说是处理数据的最佳方式，利用它可以轻松按列或按行取值，并且可以直接用向量化的方式计算。&lt;/p>
&lt;div class="collapsable-code">
&lt;input id="6" type="checkbox" />
&lt;label for="6">
&lt;span class="collapsable-code__language">R&lt;/span>
&lt;span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide">&lt;/span>
&lt;/label>
&lt;pre class="language-R" >&lt;code>
d&amp;lt;-data.frame(TraitsComb=character(0),Top4=double(0),Winner=double(0),AvgPlacement=double(0),PickTimes=integer(0))
print(d)
## [1] TraitsComb Top4 Winner AvgPlacement PickTimes
## &amp;lt;0 行&amp;gt; (或0-长度的row.names)
d[1,]&amp;lt;-list(&amp;#34;a&amp;#34;, 1.2, 2.3, 3.4, 5)
print(d)
## TraitsComb Top4 Winner AvgPlacement PickTimes
## 1 a 1.2 2.3 3.4 5
colnames(d)
## [1] &amp;#34;TraitsComb&amp;#34; &amp;#34;Top4&amp;#34; &amp;#34;Winner&amp;#34; &amp;#34;AvgPlacement&amp;#34; &amp;#34;PickTimes&amp;#34;
d$Winner
## [1] 2.3
d[3]
## Winner
## 1 2.3
d[3][1]
## Winner
## 1 2.3
&lt;/code>&lt;/pre>
&lt;/div>
&lt;h2 id="r语言函数">R语言函数&lt;/h2>
&lt;h3 id="字符串">字符串&lt;/h3>
&lt;p>观察下面的例子，只用了1行代码就实现了我想要的字符串拼接。&lt;/p>
&lt;div class="collapsable-code">
&lt;input id="846215739" type="checkbox" />
&lt;label for="846215739">
&lt;span class="collapsable-code__language">R&lt;/span>
&lt;span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide">&lt;/span>
&lt;/label>
&lt;pre class="language-R" >&lt;code>
tiers&amp;lt;-rev(c(&amp;#34;DIAMOND&amp;#34;,&amp;#34;PLATINUM&amp;#34;,&amp;#34;GOLD&amp;#34;,&amp;#34;SILVER&amp;#34;,&amp;#34;BRONZE&amp;#34;,&amp;#34;IRON&amp;#34;))
ranks&amp;lt;-rev(c(&amp;#34;I&amp;#34;,&amp;#34;II&amp;#34;,&amp;#34;III&amp;#34;,&amp;#34;IV&amp;#34;,&amp;#34;V&amp;#34;))
tire_order&amp;lt;-lapply(tiers,function(x) paste(x,ranks,sep=&amp;#34;-&amp;#34;)) %&amp;gt;% unlist
## [1] &amp;#34;IRON-V&amp;#34; &amp;#34;IRON-IV&amp;#34; &amp;#34;IRON-III&amp;#34; &amp;#34;IRON-II&amp;#34; &amp;#34;IRON-I&amp;#34; &amp;#34;BRONZE-V&amp;#34;
## [7] &amp;#34;BRONZE-IV&amp;#34; &amp;#34;BRONZE-III&amp;#34; &amp;#34;BRONZE-II&amp;#34; &amp;#34;BRONZE-I&amp;#34; &amp;#34;SILVER-V&amp;#34; &amp;#34;SILVER-IV&amp;#34;
## [13] &amp;#34;SILVER-III&amp;#34; &amp;#34;SILVER-II&amp;#34; &amp;#34;SILVER-I&amp;#34; &amp;#34;GOLD-V&amp;#34; &amp;#34;GOLD-IV&amp;#34; &amp;#34;GOLD-III&amp;#34;
## [19] &amp;#34;GOLD-II&amp;#34; &amp;#34;GOLD-I&amp;#34; &amp;#34;PLATINUM-V&amp;#34; &amp;#34;PLATINUM-IV&amp;#34; &amp;#34;PLATINUM-III&amp;#34; &amp;#34;PLATINUM-II&amp;#34;
## [25] &amp;#34;PLATINUM-I&amp;#34; &amp;#34;DIAMOND-V&amp;#34; &amp;#34;DIAMOND-IV&amp;#34; &amp;#34;DIAMOND-III&amp;#34; &amp;#34;DIAMOND-II&amp;#34; &amp;#34;DIAMOND-I&amp;#34;
&lt;/code>&lt;/pre>
&lt;/div>
&lt;p>这里&lt;code>lapply&lt;/code>是对列表遍历，将每个元素先赋值为&lt;code>x&lt;/code>，然后应用&lt;code>function(x)&lt;/code>函数。&lt;code>paste&lt;/code>函数是将两个参数连接起来，&lt;code>sep&lt;/code>是连接符。&lt;/p>
&lt;p>&lt;code>%&amp;gt;%&lt;/code>是一个&lt;code>pipe&lt;/code>，它将结果传递给另一个函数作为第一个参数。&lt;code>unlist&lt;/code>是将列表转换为向量。&lt;/p>
&lt;h3 id="排序">排序&lt;/h3>
&lt;p>对一张以下格式的数据框排序，可以使用&lt;code>order&lt;/code>函数。倒序只需要在排序的列名前加&lt;code>-&lt;/code>号。&lt;/p>
&lt;div class="collapsable-code">
&lt;input id="7" type="checkbox" />
&lt;label for="7">
&lt;span class="collapsable-code__language">R&lt;/span>
&lt;span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide">&lt;/span>
&lt;/label>
&lt;pre class="language-R" >&lt;code>
head(traits_comp_discribe)
## TraitsComb Top4 Winner AvgPlacement PickTimes
## 1 Transformer 0.253 0.025 5.696 79
## 2 Bruiser,Cuddly,Glutton,Sister,Transformer 0.922 0.314 2.373 51
## 3 Arcanist,Cuddly 0.662 0.166 3.593 145
## 4 Socialite 0.217 0.024 6.133 83
## 5 Chemtech,Twinshot 0.462 0.154 4.231 13
## 6 Clockwork,Cuddly,Transformer 0.750 0.250 3.875 8
head(traits_comp_discribe[order(-traits_comp_discribe$Top4),])
## TraitsComb Top4 Winner AvgPlacement PickTimes
## 7 Academy,Cuddly,Imperial 1 0.500 3.000 4
## 11 Bruiser,Sister,Socialite 1 0.400 6.400 5
## 32 Cuddly,Glutton,Sister,Socialite 1 0.333 2.000 3
## 34 Mercenary 1 0.071 7.286 14
## 37 Bruiser,Sister,Transformer,Twinshot 1 0.333 3.000 3
## 38 Bodyguard,Cuddly,Syndicate 1 0.250 3.500 4
&lt;/code>&lt;/pre>
&lt;/div>
&lt;h2 id="mongodb">MongoDB&lt;/h2>
&lt;p>MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富却最像关系数据库的。它提供了一个非常简单的接口，可以让你在简单的程序中操作数据库。&lt;/p>
&lt;p>在R语言中，连接MongoDB可以使用&lt;code>mongolite&lt;/code>库&lt;/p>
&lt;div class="collapsable-code">
&lt;input id="8" type="checkbox" />
&lt;label for="8">
&lt;span class="collapsable-code__language">R&lt;/span>
&lt;span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide">&lt;/span>
&lt;/label>
&lt;pre class="language-R" >&lt;code>
install.packages(&amp;#34;mongolite&amp;#34;)
library(mongolite)
url &amp;lt;- &amp;#34;mongodb://user:pass@site:port&amp;#34;
db&amp;lt;- &amp;#34;tft&amp;#34; # 数据库名
# 连接数据库
s_con &amp;lt;- mongo(collection=&amp;#39;summoner&amp;#39;,
db=db,
url=url)
# 查询数据 （查询等级低于100的召唤师）
summoners &amp;lt;- s_con$find(&amp;#39;{&amp;#34;summonerlevel&amp;#34;: { &amp;#34;$lt&amp;#34;: 100 }}&amp;#39;)
head(summoners)
## id puuid summonerlevel summonertire summonerrank
## 1 4 ******** 66 PLATINUM I
## 2 5 ******** 1 DIAMOND II
## 3 6 ******** 85 MASTER I
## 4 8 ******** 1 PLATINUM IV
## 5 9 ******** 20 PLATINUM II
## 6 12 ******** 19 PLATINUM II
&lt;/code>&lt;/pre>
&lt;/div></content></item><item><title>通过Gitbook将Markdown电子书转换为PDF格式</title><link>/posts/convert-gitbook-to-pdf/</link><pubDate>Wed, 10 Nov 2021 17:18:22 +0800</pubDate><guid>/posts/convert-gitbook-to-pdf/</guid><description>找到一本电子书 以《the-way-to-go_ZH_CN》为例，先clone下来。 预处理 GitBook使用简单的目录结构，通过 SUMMARY.md 目录文件来确</description><content>&lt;h2 id="找到一本电子书">找到一本电子书&lt;/h2>
&lt;p>以《&lt;a href="https://github.com/unknwon/the-way-to-go_ZH_CN">the-way-to-go_ZH_CN&lt;/a>》为例，先&lt;code>clone&lt;/code>下来。&lt;/p>
&lt;h2 id="预处理">预处理&lt;/h2>
&lt;p>GitBook使用简单的目录结构，通过 &lt;code>SUMMARY.md&lt;/code> 目录文件来确定哪些文件被转换。原书目录是&lt;code>TOC.md&lt;/code>，因此将&lt;code>TOC.md&lt;/code>改名为&lt;code>SUMMARY.md&lt;/code>。&lt;/p>
&lt;p>原书的图片链接都带上了&lt;code>?raw=true&lt;/code>参数，导致转换后的PDF文件里图片无法正确显示，需要全部删除&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">grep -rl &lt;span style="color:#e6db74">&amp;#34;?raw=true&amp;#34;&lt;/span> ./ | xargs sed -i &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span> &lt;span style="color:#e6db74">&amp;#39;s/?raw=true//g&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="开始转换">开始转换&lt;/h2>
&lt;p>安装&lt;a href="https://calibre-ebook.com">calibre&lt;/a>，主要是需要&lt;code>ebook-converter&lt;/code>这个命令行工具&lt;/p>
&lt;ol>
&lt;li>创建一个符号连接&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">sudo ln -s /Applications/calibre.app/Contents/MacOS/ebook-convert /usr/local/bin
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>/usr/local/bin&lt;/code>可以是&lt;code>$PATH$&lt;/code>中的任何文件夹&lt;/p>
&lt;ol start="2">
&lt;li>安装&lt;code>gitbook-cli&lt;/code>，这时会自动编译安装&lt;code>gitbook&lt;/code>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">npm install gitbook-cli -g
&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>转换之&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">gitbook pdf ./ ./book.pdf
&lt;/code>&lt;/pre>&lt;/div></content></item><item><title>About</title><link>/about/</link><pubDate>Wed, 10 Nov 2021 00:00:00 +0000</pubDate><guid>/about/</guid><description>Hi there My name is Magicwenli, a 22-year-old software engineer.
I like to code, and I am currently learning how to code. Come to see my work!</description><content>&lt;h1 id="hi-there">Hi there&lt;/h1>
&lt;p>My name is Magicwenli, a 22-year-old software engineer.&lt;/p>
&lt;p>I like to code, and I am currently learning how to code. Come to see my work!&lt;/p></content></item><item><title>Hello World</title><link>/posts/hello/</link><pubDate>Tue, 09 Nov 2021 17:18:22 +0800</pubDate><guid>/posts/hello/</guid><description>辗转反复多次，最后终于意识到比写博客有意思的是折腾博客。 下次记得留下一些被打败的凹痕，以作纪念。 - 蕾欧娜 js 新的开始 console.log(&amp;#34;Hello World&amp;#34;);</description><content>&lt;p>辗转反复多次，最后终于意识到比写博客有意思的是折腾博客。&lt;/p>
&lt;blockquote>
&lt;p>下次记得留下一些被打败的凹痕，以作纪念。 - 蕾欧娜&lt;/p>
&lt;/blockquote>
&lt;div class="collapsable-code">
&lt;input id="1" type="checkbox" />
&lt;label for="1">
&lt;span class="collapsable-code__language">js&lt;/span>
&lt;span class="collapsable-code__title">新的开始&lt;/span>
&lt;span class="collapsable-code__toggle" data-label-expand="Show" data-label-collapse="Hide">&lt;/span>
&lt;/label>
&lt;pre class="language-js" >&lt;code>
console.log(&amp;#34;Hello World&amp;#34;);
&lt;/code>&lt;/pre>
&lt;/div></content></item></channel></rss>